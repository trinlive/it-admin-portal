version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # 1. Main Application (IT Admin Portal)
  # ---------------------------------------------------------------------------
  it-admin-portal-app:
    build: .
    container_name: it-admin-portal
    restart: always
    ports:
      - "33201:3001"            # ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô http://localhost:33201
    environment:
      - NODE_ENV=development
      - PORT=3001
      
      # üëá DATABASE CONFIG (Audit Log)
      - DB_HOST=it-log-db       
      
      # üëá AD CONFIG (‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏´‡∏≤ Samba ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
      - AD_URL=ldap://samba-ad  
      - AD_BASE_DN=DC=ad,DC=biccorp,DC=com
      # ‚ö†Ô∏è Image ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ User ‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠ "Administrator"
      # ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ UPN (Administrator@ad.biccorp.com) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
      - AD_USER=Administrator@ad.biccorp.com 
      # ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö ADMIN_PASSWORD ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á üëá
      - AD_PASS=BicCorp@AD2026!

      # üëá GOOGLE OAUTH CONFIG
      - GOOGLE_CALLBACK_URL=http://localhost:33201/auth/google/callback

    volumes:
      - .:/app
      - /app/node_modules
    networks:
      - app-network             
      - cf-network
    depends_on:
      - samba-ad

  # ---------------------------------------------------------------------------
  # 2. Samba Active Directory (New Image: linuxcrafts)
  # ---------------------------------------------------------------------------
  samba-ad:
    image: linuxcrafts/samba-ad-dc:latest   # üü¢ ‡πÉ‡∏ä‡πâ Image ‡πÉ‡∏´‡∏°‡πà
    container_name: samba-ad
    restart: always
    cap_add:                                  
      - SYS_ADMIN                           # ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Domain)
    environment:
      - DNS_DOMAIN=ad.biccorp.com             
      - ADMIN_PASSWORD=BicCorp@AD2026!      # üîë ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å
      - DNS_FORWARDER=8.8.8.8                 
      - HOSTNAME=samba-ad                     
    volumes:
      # ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ Volume ‡πÉ‡∏´‡∏°‡πà (samba_data_new) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
      - samba_data_new:/var/lib/samba            
    networks:
      - app-network

# ---------------------------------------------------------------------------
# Volumes & Networks
# ---------------------------------------------------------------------------
volumes:
  samba_data_new:

networks:
  app-network:
    external: true              
  cf-network:
    external: true