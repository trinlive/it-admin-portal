version: '3.8'

services:
  it-admin-portal-app:
    # ‚úÖ ‡∏™‡∏±‡πà‡∏á Build ‡∏à‡∏≤‡∏Å Source Code
    build: .
    
    image: it-admin-portal:latest
    container_name: it-admin-portal
    restart: always
    environment:
      - NODE_ENV=production
      - PORT=3001
      
      # üëá Database Config
      - DB_HOST=it-log-db
      - DB_DIALECT=mysql
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASS=${DB_PASS}
      
      # üëá AD Config
      - AD_URL=ldap://samba-ad
      - AD_BASE_DN=${AD_BASE_DN}
      - AD_USER=${AD_USER}
      - AD_PASS=${AD_PASS}
      
      # üëá Google OAuth
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_CALLBACK_URL=${GOOGLE_CALLBACK_URL}
      - ALLOWED_EMAILS=${ALLOWED_EMAILS}
      - SESSION_SECRET=${SESSION_SECRET}

    networks:
      - app-network
      - cf-network

networks:
  app-network:
    external: true
    # üëá ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö! ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ Network ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Database (it-infra_app-network)
    name: it-infra_app-network
  
  cf-network:
    external: true
    # üëá (‡∏ñ‡πâ‡∏≤ Stack Cloudflare ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ cf-network ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö)
    name: cf-network
